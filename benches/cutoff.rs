use redtail::board::{Board, Position};
use redtail::search::evaluate::Evaluator;
use redtail::search::options::SearchOptions;
use redtail::tt::TranspositionTable;
use redtail::Cutoffs;
use std::sync::{atomic::AtomicBool, Arc};

// Test positions for cutoff benchmarking - complex tactical positions
const CUTOFF_POSITIONS: [&str; 300] = [
    "8/p2p2r1/k6P/2Q2P2/1Bp4p/4P1RN/7n/2RK4 w - - 0 1",
    "8/5K2/P1P1P3/3RN2p/1k2PP2/6P1/p1Rp2qr/8 w - - 0 1",
    "2k3n1/3q1p2/1P5P/3n1PQN/b6P/2p4P/1P2K3/8 w - - 0 1",
    "4R3/8/p1Nk2K1/BPp5/6P1/bp2r3/3p1P2/3N1q2 w - - 0 1",
    "4r3/Pk3P1P/4p2P/8/R4B2/6NP/pn5K/Q5N1 w - - 0 1",
    "1rn5/2P4r/8/2k3p1/K4R2/bp2pp1P/3N3R/7Q w - - 0 1",
    "3b4/1np2Kp1/3pPP2/1q6/1P5p/P3Pk2/2N5/1n6 w - - 0 1",
    "r6B/1b3pPp/p2K4/5P2/7P/1RP5/1Pp5/6bk w - - 0 1",
    "5k1r/7n/4p2p/1pp4B/Pbp3NP/p4K2/8/2R5 w - - 0 1",
    "4K3/1pR5/pp2P3/2p4k/5Pb1/1PNPb3/8/2B1q3 w - - 0 1",
    "4n3/3B2P1/2p3K1/1PPb4/2p4B/k1pr4/3b1R2/5N2 w - - 0 1",
    "1b6/6p1/7P/2R5/K3b1P1/1p1rpk1q/2P2p2/N4B2 w - - 0 1",
    "6n1/Rb2bB2/6Pp/P2P4/1P2p3/k5Kp/5Q2/1r6 w - - 0 1",
    "6B1/8/q1QP2p1/1np3K1/1k6/p1rPn3/R5RB/8 w - - 0 1",
    "8/1n1p4/2P2R2/B2bp1Nk/n5p1/6K1/2p1r3/2b3R1 w - - 0 1",
    "2Q2K2/P5p1/4rPp1/3k1PP1/1P6/2R5/2Rp2P1/1N6 w - - 0 1",
    "8/p1NkP3/6N1/1rP3n1/2p3pp/2B3R1/P3K1P1/8 w - - 0 1",
    "6n1/5q2/8/3RQ2p/4K1p1/1P3p1p/pP1Pb1r1/2k5 w - - 0 1",
    "2b2n2/p3R3/2qk1K2/2R5/5Np1/8/1Qp1PPP1/7n w - - 0 1",
    "2RR4/P3pkP1/N2P4/3pB2K/1P2p3/8/3p1p2/3Q4 w - - 0 1",
    "3n4/5p2/p1P5/1PP1p3/4p2k/2br4/3P1p1P/1K1R4 w - - 0 1",
    "2R5/5Kp1/2N1B2k/qr1P4/pPp1b3/1N1p4/4p3/8 w - - 0 1",
    "8/3pN2P/1R1p2B1/5P2/3p3P/2RQ1p1K/k1P1p3/8 w - - 0 1",
    "5q2/1Pn3PP/p2p2K1/b7/b6k/4B3/3R2QP/7r w - - 0 1",
    "8/4P2p/P1rp1R1p/3q4/3P1p1k/P7/1K3b2/n1r5 w - - 0 1",
    "8/6N1/1QPbB1p1/6K1/6P1/2p1pPP1/1p2bn2/k7 w - - 0 1",
    "br6/3Bk1P1/K5Q1/3P4/8/1N2rP1p/p4p2/4b2q w - - 0 1",
    "3r4/6b1/2B4P/6n1/3p1P1N/P1pP2kP/p3K3/q7 w - - 0 1",
    "1Rn2q2/2b5/p1P2B2/P6P/1P6/7k/P1K3pn/6R1 w - - 0 1",
    "8/1B1p4/4b3/PK3N2/1Pp2p2/2P5/P1p2k1P/b2n4 w - - 0 1",
    "8/Pb2B2P/pKB1k2b/1n3R2/p4p2/7p/1P5Q/8 w - - 0 1",
    "2n5/4PK1B/Pp6/B6k/2NP4/6b1/2pp1R1p/1n6 w - - 0 1",
    "7k/R2r4/2pR2K1/2p5/p6P/2PQPP2/N4pP1/8 w - - 0 1",
    "R2B4/4p1pP/8/1k5r/2nr4/q2PQ3/1P3N2/2n2K2 w - - 0 1",
    "8/p1BKP3/5P2/1P2R1n1/p1ppP3/4N3/2n2kp1/8 w - - 0 1",
    "3R4/5P2/1P6/1K2k1P1/1BP5/1pP5/n3pb2/1Q4Nn w - - 0 1",
    "3R1b2/PR6/3PpN2/1B1P2n1/P1P3K1/k7/b3p3/8 w - - 0 1",
    "3N4/1K1p3R/p1r3P1/4BPkP/8/n1N5/4pbP1/8 w - - 0 1",
    "1R6/Pp1P1nP1/BB5p/2K1k2r/p7/8/Q5r1/N7 w - - 0 1",
    "8/5p2/1k5q/5p2/1p3PPP/3PP1p1/K1b1R2b/B7 w - - 0 1",
    "3B3k/p4P2/7P/1PKPP3/2BP1p1P/6Nr/4Q3/8 w - - 0 1",
    "2rR4/1p4p1/1P3kp1/5b2/2N3np/3PQK2/6B1/2q5 w - - 0 1",
    "6BB/1p6/1Kpp3p/2QNR1br/8/3P2N1/k3P3/8 w - - 0 1",
    "2b5/8/p7/1Np1K3/P4npR/p3Q2P/3p2P1/2bk4 w - - 0 1",
    "7q/5p1k/2RK1P2/3P4/QB2NPp1/r3bp2/6P1/8 w - - 0 1",
    "8/4r3/1Kpkp3/3N4/P6Q/8/NRqPpP2/b5n1 w - - 0 1",
    "8/p2P1ppp/3Q4/1K6/6Pk/2p4N/4PpB1/qb6 w - - 0 1",
    "8/P2rkn2/Pp6/B7/p3P1Rr/K1N1p3/3n4/7q w - - 0 1",
    "8/q7/1P2p3/2N1K1B1/2R3bP/p4p2/1NP1P2p/7k w - - 0 1",
    "nB6/1pp2Pb1/8/Pp1r4/p7/1k3P2/6rp/1BK5 w - - 0 1",
    "K2B4/8/P1k2P2/1b1p4/pp4Q1/1p6/BppP2P1/8 w - - 0 1",
    "8/1P1Q1p2/P2P2p1/1N1P1P2/RK6/8/2b3kq/n3B3 w - - 0 1",
    "5q2/pPQ5/2K3kr/7N/5p1p/3P2pp/b5p1/1R6 w - - 0 1",
    "b7/8/3N2pP/2Rpb1Q1/B7/3P3K/4Pk1p/2rq4 w - - 0 1",
    "k1b5/p6R/1r2P3/1PPN4/6P1/P4P2/3K1p2/6nQ w - - 0 1",
    "1r5B/7p/3p4/1kP1p3/3p1NB1/1p3P2/4r3/nb1K4 w - - 0 1",
    "8/1BRP1P2/1B2K3/2P1P2k/1NQ1pR1q/3P4/8/b7 w - - 0 1",
    "3r4/7N/pPP4N/8/5P2/2pp2bP/p1r5/1q1k1K2 w - - 0 1",
    "7K/7p/5P2/p2Q1BP1/2n2P2/2pNrPk1/4P1p1/8 w - - 0 1",
    "1k2N3/8/5q1P/1p2pp2/1n1p2R1/1P4p1/1Q1K2Bp/8 w - - 0 1",
    "8/1PP2P2/2p5/2qRrn2/Kn3p1P/5R2/N6p/1k6 w - - 0 1",
    "1q6/4N2r/5K2/1PP5/1k2pPb1/4B3/1pp2np1/4R3 w - - 0 1",
    "5R1r/7P/2K4B/6Pp/P1n2b2/8/3pn1P1/2kNr3 w - - 0 1",
    "8/p7/3P1Pp1/3N1pr1/1p6/P2B2b1/kp2r1b1/3K4 w - - 0 1",
    "b2Q1n2/5p1P/1P1KP3/nP3p2/8/5pk1/7b/3N2q1 w - - 0 1",
    "r7/P2N4/B1k1p2n/2b5/Pp1p2P1/6PK/3p4/Q7 w - - 0 1",
    "5K2/5p2/1Pp5/b1pN1r1P/P5p1/7k/5r1p/3QB3 w - - 0 1",
    "1Kb2b2/p3P3/2pP2RR/P7/2N5/2r5/k2n1P1p/8 w - - 0 1",
    "6k1/2p4p/pB2P2P/3P2Kp/N3p3/1r6/8/3RbR2 w - - 0 1",
    "1r3R2/2k2b2/7p/p1Pr4/6B1/p6K/p1PP4/2q3b1 w - - 0 1",
    "6r1/1RB1n1k1/1P2p1r1/2p2n2/p1P5/2p3pK/8/7b w - - 0 1",
    "8/p7/1NQp4/2b2prP/Pq2pP2/1k6/5n2/2B2K2 w - - 0 1",
    "3b1B2/5K2/3Pp1pP/3Nk2P/1P1p3P/8/1p4Rr/8 w - - 0 1",
    "2n1K3/2b2p2/1p5r/P4k1p/p7/3P4/2P1B2P/2N3N1 w - - 0 1",
    "7B/8/4b1P1/2p1P3/B5P1/1Npp3K/2k1rq2/3nQ3 w - - 0 1",
    "5K2/2Nr1Q2/B3PP2/P2PP3/6pn/4k3/P1p4b/8 w - - 0 1",
    "1k6/p2K3P/b2PPr2/p7/P4Q2/p3R3/3P4/n4N2 w - - 0 1",
    "4B3/P2P3b/P6p/p6n/3P1n1r/3pP1k1/1K3p2/8 w - - 0 1",
    "b7/4p3/7P/1BB2Nkn/p7/3P2p1/P4P1P/3K2n1 w - - 0 1",
    "6r1/PP2P3/2Kp4/5BP1/2pP2p1/5k1p/2nr3P/8 w - - 0 1",
    "7r/p1R5/B2P1b2/pppKP1Pk/4n3/3P4/8/5b2 w - - 0 1",
    "2Q5/b2P1P2/r1N1K1P1/8/8/5kp1/Bp2pPp1/7N w - - 0 1",
    "2k5/n2qR3/1b2bP1P/1pP1p3/1K6/P7/4r3/3Q2N1 w - - 0 1",
    "1R6/3P4/b2P2p1/4r3/1b1p2R1/p7/2Kpq1P1/2N2k2 w - - 0 1",
    "1r4b1/1P6/Pb3Pk1/1R6/p5Pn/2K2p2/2pp4/3r4 w - - 0 1",
    "2n5/1bk5/4n2b/R1q3PK/5P1p/PP2BN2/r7/8 w - - 0 1",
    "6r1/1p1K2nk/7p/3P2b1/1p6/QP2N3/4R1Pq/n7 w - - 0 1",
    "1qr5/B7/3p2PK/3Q3p/r1p1P3/1p2n3/2kP3P/8 w - - 0 1",
    "8/k1r5/p4P2/N3p1Pq/1Rp1p1p1/6r1/1Bp5/4K3 w - - 0 1",
    "1R2B2q/3pN3/p1p3K1/2P4P/p2P1b2/7k/2p3b1/8 w - - 0 1",
    "6NR/5pP1/b2p4/2pKP3/1b1n1Q2/2k5/4P1P1/6B1 w - - 0 1",
    "K7/3r2P1/PNn3q1/p1R5/p1QP2N1/k7/5P2/6r1 w - - 0 1",
    "n7/2p5/1BP5/2R2P1P/1p2B2K/2nP2pp/4r3/4k3 w - - 0 1",
    "R4K2/4PN1B/2p5/3q1Rp1/P7/1k1b1p2/4PP1p/8 w - - 0 1",
    "6k1/2N3P1/1r6/3p3B/4P1pK/2B2P2/p1R2pp1/4r3 w - - 0 1",
    "6K1/1p6/4Pb2/p1P5/kP2N1p1/1N1Q1RP1/3q4/7b w - - 0 1",
    "3kb3/p5n1/3pP3/3PP2Q/1K3p2/7q/P2P4/6BN w - - 0 1",
    "4B3/1K1P4/2P1pP2/4pr2/3b1B2/2np3P/5kb1/R7 w - - 0 1",
    "7B/2P3rN/5p2/p1k1q3/2n1B1p1/1K5P/P1R3Q1/8 w - - 0 1",
    "R7/1pk3P1/1p2P3/n5P1/1p1Q1pK1/3B3r/2r4b/8 w - - 0 1",
    "8/4P3/Q7/P6N/P1P1P1K1/4k1BR/br2P1B1/6R1 w - - 0 1",
    "3nr3/4Pp1p/6k1/3K4/Q1Np4/2P4p/2bBr3/6n1 w - - 0 1",
    "5K2/3p2P1/6P1/2PpQ1p1/4qP2/p1p1p3/k1p3b1/8 w - - 0 1",
    "r7/1p6/1K3kpP/2p4R/1PP2BbN/p6Q/5p2/8 w - - 0 1",
    "3n4/5P2/p3p3/4k1P1/1RKpN1pP/1p5N/3Q4/6n1 w - - 0 1",
    "1q2R3/1p2PP1P/3B4/p4R2/3k4/p4K1Q/p2p4/7n w - - 0 1",
    "1kB5/8/1P1p1pKp/1pR4p/1r6/5n2/2P1P1P1/4N3 w - - 0 1",
    "bBN5/3P1p2/1Pk5/2p2p2/8/2n2KRB/RP6/6b1 w - - 0 1",
    "8/3qr3/5K2/3B1P2/1NPn3p/3R4/rkN1Ppp1/8 w - - 0 1",
    "5N2/3R2n1/b3qR2/5pP1/2n3k1/P1K2p2/4prp1/8 w - - 0 1",
    "3r4/p2k1p2/3P4/P7/3Pp1p1/1b1pp3/6PP/K3n3 w - - 0 1",
    "6R1/3p4/rpp5/3P1Q2/P4P2/1NK2Rp1/k5P1/5n2 w - - 0 1",
    "r6k/b1Rp4/2p5/n5N1/8/5PP1/1pKnp3/6Nb w - - 0 1",
    "B7/1Pr2R1n/b2p3P/5pPP/5b2/5K1k/4Q3/1r6 w - - 0 1",
    "8/5p1n/P5Pp/2Q3R1/p1r1k3/3p3P/P1p3KR/8 w - - 0 1",
    "8/2p3R1/p1b2K1n/1N6/8/1k1qp1p1/p2P4/r1B3b1 w - - 0 1",
    "1bN5/8/1p2P1B1/1P1k1p2/5p2/1P4Nq/4KR2/2r1B3 w - - 0 1",
    "1K6/1p3PpB/5R2/3PB1pp/6P1/4P1n1/3NN2k/8 w - - 0 1",
    "3Q4/1P6/P7/P1np2p1/3p4/q3PR1K/3p2B1/2kr4 w - - 0 1",
    "2r2k1r/1P6/2P1R1P1/1R2pP2/4P2N/1q4B1/2N3K1/8 w - - 0 1",
    "1B4Q1/2nP4/P2p4/3p4/1p1p1pp1/3p1P2/1K5k/N7 w - - 0 1",
    "4N3/5Ppb/N3K3/1P6/2P5/p2P3r/Rpp2k2/4R3 w - - 0 1",
    "2b5/3kPr2/1n3q2/B7/PK3p1P/p1P2P2/3P1N2/8 w - - 0 1",
    "7r/1PP5/B3P3/P7/2K2pPp/3pp1B1/1k2p3/1b6 w - - 0 1",
    "N7/1b2p2p/2Pb2p1/P4P1P/4k1p1/1pP5/1Q6/5K2 w - - 0 1",
    "8/r4P1P/1P1pP2K/1n6/p5N1/5Pbb/7P/1k5q w - - 0 1",
    "4N3/P1R1Pp2/B6p/2K4n/2pp3P/3Pk3/1RP5/8 w - - 0 1",
    "2NR1n2/N4k2/1B6/n3P3/8/pp1K4/pP3p1Q/q7 w - - 0 1",
    "3N2b1/2P2Pn1/2p2R2/7r/2Q5/3KPPnp/1p6/1k6 w - - 0 1",
    "1R5n/3PK2b/n7/rN1P3B/3p4/p3P1P1/8/2b4k w - - 0 1",
    "1R3b2/5r2/2P4P/7R/B1K3p1/2B2kr1/1Pp3b1/3q4 w - - 0 1",
    "3N1bR1/8/P1r1p2k/2P5/K3P3/P1Q2B2/2p4P/1q6 w - - 0 1",
    "2R5/P2p2N1/1P2Pp2/5r1P/1p1p4/8/1p1K2P1/k1B5 w - - 0 1",
    "q1n5/Pk2B1Q1/6nR/5P1p/2K2p1p/3P4/1p1p4/8 w - - 0 1",
    "6q1/Q2B4/1P2prkN/8/3nK1P1/1p6/PB3R2/7R w - - 0 1",
    "1rR1B3/8/P1N5/3Pp1P1/pP6/3K3p/k2P3b/5N2 w - - 0 1",
    "2r5/2p1KP2/1p6/2k2q2/b2p1RPB/1B6/3pP3/n7 w - - 0 1",
    "2q2n2/2Bp1Bp1/4N2P/4P3/7k/N2RPK2/6P1/1R6 w - - 0 1",
    "7K/2pQp1P1/8/p4p2/8/P1n4P/P3kbPp/1R6 w - - 0 1",
    "8/b1K5/1p6/4r3/Pk1nr3/3pR1p1/1Pn1B3/R1N5 w - - 0 1",
    "1K2b1kN/1B6/1P1P1B2/2p3Pp/p2n4/4R1p1/2p5/8 w - - 0 1",
    "2b1qN2/4P3/pp3Q2/k1P1K3/4Pp2/8/n4p2/3r1r2 w - - 0 1",
    "3n4/b2K2P1/3R4/5P2/4ppp1/r2pP2k/b1p5/4Q3 w - - 0 1",
    "1B1Nq3/1PPk3n/3b4/2n5/6b1/4r1pR/3Kp1p1/8 w - - 0 1",
    "8/8/2k3pN/5p2/1PpPr2p/B2p2R1/nK1P4/7n w - - 0 1",
    "2b5/P1nPp2k/p3P3/7P/N7/P5Rq/B3K2P/8 w - - 0 1",
    "5k1N/2Np4/8/2p1P3/1R1pp3/1P6/2Pp4/2nb2BK w - - 0 1",
    "2B2Rr1/NK6/2P1P1pP/4p2r/1bk2p1P/8/1B6/8 w - - 0 1",
    "5R2/2r5/4Kb2/6p1/B1P1k1n1/P1PbP1q1/2p2p2/8 w - - 0 1",
    "2Q5/K1n2NP1/N3p2R/1k3pp1/8/6B1/p1BP2P1/8 w - - 0 1",
    "6Q1/R1PP4/1P1P2p1/1K6/2pp1k1N/4nB2/3R4/5N2 w - - 0 1",
    "3K2R1/4P2k/3P1p1p/1bB3r1/2Q1p1q1/3P1N2/2R5/8 w - - 0 1",
    "2N4q/2b5/2P5/p2r4/Q2P2pp/2P1K1k1/p3p3/7R w - - 0 1",
    "5N2/1p2K1P1/2rB2P1/4pP2/P4k1n/2p5/P4bB1/8 w - - 0 1",
    "8/7K/1p1Q2p1/1pqRP2p/1P6/1N4k1/P2n4/3r1b2 w - - 0 1",
    "k5n1/2P1n2p/2b4p/6p1/2N3p1/pR5P/4Br2/4K3 w - - 0 1",
    "3r4/B7/5p2/RKn1k2P/3pb2p/1p1p4/3P4/1N5N w - - 0 1",
    "8/R1p5/8/1bbN2P1/p3P3/1pn5/P1n1pBK1/2k5 w - - 0 1",
    "3q4/5B2/pP3P1n/3P1NbP/P1K5/1p6/6bp/1k6 w - - 0 1",
    "8/5N2/2P1pp2/Kn1k1r2/5qp1/5p2/1R3pbB/5B2 w - - 0 1",
    "7q/1PR1P3/Np6/n1p5/8/3r4/1R1bP2p/K1B4k w - - 0 1",
    "7k/1B3Q2/N1p4P/2ppP3/1p5P/1bP5/3K2p1/7n w - - 0 1",
    "8/P5bp/R6q/1r6/KPp5/2P4k/2n3b1/N2Br3 w - - 0 1",
    "R2b3K/7n/2kp1P2/6q1/2P3p1/3P4/P1NP4/r4R2 w - - 0 1",
    "1Q6/1p3K2/P3r1p1/1p2p3/6pP/R2P2r1/2kP1P2/8 w - - 0 1",
    "2r5/r3Pb1n/1K2P3/4QP2/p2P2k1/4p3/P4P2/R7 w - - 0 1",
    "8/nk6/2r1B3/b4np1/4b3/p3P3/Q1P4N/KN4q1 w - - 0 1",
    "8/3rPPB1/8/5BR1/p1k1pb1p/6Pp/1K6/6nq w - - 0 1",
    "8/7n/pp4N1/q6p/1k1rbP2/2R2PpK/r6p/8 w - - 0 1",
    "2N5/8/R2KP2B/n1PP2p1/2pPp1r1/8/4p3/2N4k w - - 0 1",
    "1Q3n2/4k3/1p2P1PK/1p2PP2/8/6p1/p1R4p/rr6 w - - 0 1",
    "6n1/5P2/1P2PpP1/1r2k3/Q7/2p3p1/R1N2R1P/5K2 w - - 0 1",
    "8/Q3K3/3N4/2Pq4/2n1p3/1p3PP1/2pB2b1/2b2r1k w - - 0 1",
    "3K3B/6n1/6p1/2r1R3/p2k2p1/2b2p2/PNp2P2/3B4 w - - 0 1",
    "4r3/3p1p2/8/NQ4K1/pP1R4/4k3/BP2P1pP/1n6 w - - 0 1",
    "1k6/8/P2p1n2/4Pp2/3p1PQp/2nb1Rr1/5K2/6B1 w - - 0 1",
    "b7/2Bp2P1/7k/R1P5/4pP1n/RK1B4/p2qP3/8 w - - 0 1",
    "7B/1k3B2/4Q3/2p3pK/1q1P1b2/4PR1n/5PP1/5R2 w - - 0 1",
    "2q4B/p3K1N1/6pP/k2P4/1p1n2n1/7p/4Q1Bb/8 w - - 0 1",
    "1q6/p3P3/3Qp1r1/8/1P2K1N1/1Pk1B2N/5p1P/4n3 w - - 0 1",
    "2KB4/kp2R3/Pp2Pb2/2p4P/8/2R2pp1/8/3r3b w - - 0 1",
    "6k1/8/5p2/P6p/4K1P1/2Pn4/Pb1pn1Np/3Q3B w - - 0 1",
    "3N4/2k1PP2/1r2p3/K1p1n3/5P2/2Q1q2B/2p3pP/8 w - - 0 1",
    "8/p6q/8/3PPpP1/p2p2P1/rk6/p3pK2/2n3r1 w - - 0 1",
    "1r1N4/2pP3P/5P2/4P2p/3K2R1/bR6/P2P4/6nk w - - 0 1",
    "3R4/KN3n2/8/1k1P2PN/1B5P/p1RrP2p/7p/8 w - - 0 1",
    "3r4/2P1p3/B3p2k/P2p4/p1rP3N/q7/4p2P/1K6 w - - 0 1",
    "2b5/3pk1p1/7p/3rP3/p2p1P2/3pP3/P4pKN/8 w - - 0 1",
    "7r/2n2PN1/P3R1P1/3pp3/R4pK1/3Bk1p1/5p2/8 w - - 0 1",
    "8/1PNB4/2P2p2/RP2P2r/1BP1kP2/8/N2K4/2r5 w - - 0 1",
    "7Q/pp6/b2R1p1n/P2p4/N2Pr3/8/2k3KP/5r2 w - - 0 1",
    "6bQ/k2P4/2q5/5PKp/7p/1NnPP1p1/2R1B3/8 w - - 0 1",
    "4R2q/2P3n1/2P5/1KpP4/6P1/1Pp1r3/bbr4k/8 w - - 0 1",
    "2K5/r2P4/5PN1/3b1k1p/3B4/1r1NQ3/2R3p1/4b2n w - - 0 1",
    "3bn1B1/3k2pp/1P6/2p5/8/PP4r1/n4P2/Q3N2K w - - 0 1",
    "4q1NB/4p3/1p2P1P1/5pk1/3N1p2/3KPn1b/1P6/8 w - - 0 1",
    "r1B5/2bQ4/4N1P1/8/2pq4/2Pp3P/1P1R1PK1/k7 w - - 0 1",
    "2K2n2/2P3P1/1qP4R/6kP/2p4b/B2B1r2/b2p4/8 w - - 0 1",
    "k2r1N2/3R1p1P/3b4/1K1p4/2r2P2/7n/1P6/3Q2BB w - - 0 1",
    "2n2r1q/QR1p4/8/5k2/p2P2pP/p1N1K3/6b1/6B1 w - - 0 1",
    "8/N1p2Kb1/p6Q/p3Bpq1/1r5r/4k2P/8/2n2n2 w - - 0 1",
    "K2bk3/PR5q/p2P2b1/7p/6nN/P7/1p3P1R/8 w - - 0 1",
    "2R5/2pp3P/R5P1/1Pk1p3/P3p3/2P5/BK1P4/6b1 w - - 0 1",
    "4Q3/P5Pb/3rp3/k1P4P/2p1p2p/4b3/K7/6Bn w - - 0 1",
    "2K5/3P2k1/rb6/P7/4PP2/1p4pB/3np2q/1Q1N4 w - - 0 1",
    "2k5/rpp2RB1/2q5/1P1n3p/pP2KN2/2P4P/8/8 w - - 0 1",
    "3b1B2/p2p4/2Pp3P/1Rp4r/4N3/K6k/8/1N2Q2b w - - 0 1",
    "r3b2B/3Q3n/4P3/2R3P1/pb1P4/2P1n3/7N/1K5k w - - 0 1",
    "8/5K2/P2q2Qp/2p3Rp/3r1bnk/7p/3B4/R3N3 w - - 0 1",
    "1bk1K2n/1R1p3b/1BPP1r2/1B3P1P/8/8/4n2q/8 w - - 0 1",
    "1qB1k1r1/1PP3P1/3p1K1p/4p3/3N2P1/2p5/3P4/7Q w - - 0 1",
    "4N3/3p4/P6k/3r1p2/q1P1RN1p/ppb5/p6K/8 w - - 0 1",
    "8/3rb3/3p2KB/1p4NP/1P2R2p/kP3P2/7p/5n2 w - - 0 1",
    "6K1/N7/1PP1B3/r1n1p3/1q2P1b1/6p1/Rn1b4/7k w - - 0 1",
    "4k3/4P3/b1r5/N2r1P2/K1P3R1/1R4P1/4Pbp1/2B5 w - - 0 1",
    "1n3k2/4Rn1P/P6P/pp1p4/7N/1bBK4/7P/2b5 w - - 0 1",
    "2K5/p2r2B1/1NN1k3/1P6/Rp3pP1/1pQ5/4b2b/8 w - - 0 1",
    "2B3Q1/5P1p/2R5/K1b3pq/3B4/2p5/1p3P1p/3k3b w - - 0 1",
    "4b1R1/2K5/1p1Bp3/6np/2p1pq2/2Pp2P1/B7/3k4 w - - 0 1",
    "4K3/1rp5/2B3kP/1p5n/1R6/Pp3p2/P1b2N1P/8 w - - 0 1",
    "4k2N/Pp3b1B/1p1P4/Q7/4P2K/6r1/1q5b/1n1R4 w - - 0 1",
    "8/3PQPN1/3p2RP/7K/1P6/qk2pB2/1n2PP2/8 w - - 0 1",
    "5Q2/8/KR3P2/1pr5/3pn2r/P2pP1P1/3N1k2/4n3 w - - 0 1",
    "5N2/q1r4p/2pp4/6Pn/1K3b1k/4B1N1/P7/6Qb w - - 0 1",
    "1k4nK/3R4/3p1p2/q4Q2/1P2P2p/5P2/P1N3p1/r7 w - - 0 1",
    "1q5N/5P2/5P2/1pn2Rpp/2R5/4NPk1/1P6/b4K2 w - - 0 1",
    "2n2b2/4P3/3P2p1/1B1Pkp1p/Q7/P2K4/b6P/5R2 w - - 0 1",
    "4b3/2P2P2/n7/1p2pr2/1N1rk3/p3P3/K5P1/2NB4 w - - 0 1",
    "8/2p1rPk1/2R1n1r1/5K2/3p4/3P2pP/2R1p1B1/2q5 w - - 0 1",
    "6N1/5Pn1/2PppP2/6p1/P7/k2PP2n/4p3/5R1K w - - 0 1",
    "8/R5p1/3k3P/1P3pb1/6pP/2p1P2P/p4KR1/1n6 w - - 0 1",
    "k7/P3P2n/2K2P2/5r1b/2B5/1p2Q1p1/P3p1PR/8 w - - 0 1",
    "5q1b/Q1p1B3/6K1/8/1p1P4/1p2NrRp/p6P/7k w - - 0 1",
    "7b/5Pp1/8/1B2p2p/3p1Pk1/3P4/p1p1N1K1/2q1N3 w - - 0 1",
    "q4N2/3r4/6K1/3N4/p1kP2P1/1R1n2pp/1Pb1P3/8 w - - 0 1",
    "n5k1/P1b5/p5q1/2P5/6N1/2NP3K/nrPP1p2/8 w - - 0 1",
    "2n5/p2p2P1/6P1/bp1P3K/2Np2P1/2kp4/7p/1R6 w - - 0 1",
    "3b4/n3P3/1Pp5/3Pk1P1/5p2/5KN1/P3p3/1R2N1r1 w - - 0 1",
    "n2B4/7b/4K1QN/2q5/1P2Pr1p/N5P1/R2p4/3k4 w - - 0 1",
    "q7/4b3/3P2N1/2p2Qr1/1n4n1/2Pb2Pp/1k6/5RK1 w - - 0 1",
    "8/1PpKP3/3pP2P/4Pp2/2q1n1N1/3R3p/8/4k1B1 w - - 0 1",
    "2R5/QP1n1Pk1/5p2/5K1b/N2p4/R7/5PqP/B7 w - - 0 1",
    "8/3p3P/3B1r2/2PK2k1/8/n2p1P1p/2b1QP1R/b7 w - - 0 1",
    "2R4K/p2q2n1/4p1kb/5p2/P1P5/r1p2P2/5Q2/5n2 w - - 0 1",
    "4R3/p2p4/1P3PNP/3PK1pR/3pP3/6p1/2P1k3/8 w - - 0 1",
    "4n3/4p1Pk/7p/4p2K/b6P/p5b1/1P3pP1/6nB w - - 0 1",
    "8/4p3/6p1/p5R1/4p1PB/1BP3pK/2ppRP2/3k4 w - - 0 1",
    "3B4/6PR/3kPP2/3p2P1/3Kbp2/1p1p1r2/4q2n/8 w - - 0 1",
    "R5B1/1nP1r3/N2Q1N2/3P1p2/4P3/P2P4/p1K3k1/8 w - - 0 1",
    "7B/P3pR2/8/2KQP1qN/7k/pp6/3r2Pr/5b2 w - - 0 1",
    "KR6/4P3/7B/2p4N/1P1pk1P1/6rQ/2p1bp2/3n4 w - - 0 1",
    "4b3/1P3p2/6qb/1p2P1n1/B3P3/3kpn2/N7/K5Q1 w - - 0 1",
    "3k2B1/8/2PppP1K/2rb4/3p1R1P/pn4P1/p7/8 w - - 0 1",
    "5K2/Q2N4/1p6/Rp1p3P/8/1pB4r/Nbk5/r2R4 w - - 0 1",
    "3K4/3P1P1r/6p1/R1b4P/R1P1p3/4Pn2/5Pr1/4k3 w - - 0 1",
    "8/1R1p4/3r3p/N4K2/b2P1B2/1Rp2p2/1q5b/5kn1 w - - 0 1",
    "6K1/5r2/5p2/qr1PR3/QB1P4/p5k1/p2pP3/2N5 w - - 0 1",
    "5Br1/3R2pP/8/2r2P2/5pq1/K4PP1/R1p5/2kn4 w - - 0 1",
    "K7/3k4/5Qp1/B1PP3R/1P2P3/3n4/1p1q4/1N2bB2 w - - 0 1",
    "2K5/4qk2/5PN1/1pnp4/7B/1r5P/p4Pp1/1R5Q w - - 0 1",
    "7B/P1pB4/2Q2n2/3b3k/3p2r1/2R2P2/4Pp1p/3K4 w - - 0 1",
    "8/1q1p1b2/2pp3p/K5k1/4PpP1/2pr3P/4r1P1/8 w - - 0 1",
    "K7/3r1b1r/P5Pq/4PP2/4R1p1/n2Np3/3P4/3k4 w - - 0 1",
    "8/4PNn1/3p2PP/3kB3/8/2q2P2/1P2pr1b/1K3b2 w - - 0 1",
    "8/p3P1PP/4PKbR/8/B4p2/1p6/3B1pk1/r1r5 w - - 0 1",
    "1b4N1/2BP4/P1k5/5p2/1PN2Ppp/6P1/4r3/1K2n3 w - - 0 1",
    "1q6/4K3/1b1n4/2R5/2RBN3/kp1P2pQ/5n2/4N2b w - - 0 1",
    "1n6/5p1K/4b3/q1p2P2/1P3k2/1Q2p3/n5rp/2RB4 w - - 0 1",
    "4r3/1K2N2k/7p/6R1/4p3/1N1ppP2/2Q4B/1Rn4b w - - 0 1",
    "8/7P/kP2b1p1/P5p1/B7/2p5/P2p1BKn/4Nr2 w - - 0 1",
    "N1K5/r5p1/8/k5p1/1qb2b2/6p1/1Pr1pQ2/5B1R w - - 0 1",
    "2N5/2P2P2/1p6/2Pnb3/k1p3p1/2Pr3R/1PK1P3/8 w - - 0 1",
    "K7/3P1p2/p2p4/2r4r/1B3P2/6Pk/P3pn2/1R3n2 w - - 0 1",
    "K2B4/4p1pN/1p2n3/2p2p2/6n1/2P2R2/2b2pk1/3R4 w - - 0 1",
    "1b6/5K1p/5n2/2R1PP1P/1kp1qP2/3p1b2/5pr1/8 w - - 0 1",
    "2K4b/3n2p1/3pnk2/3pp2Q/4P1p1/4P3/1P3p2/5b2 w - - 0 1",
    "5R2/P7/6p1/1Pp1Pr1P/3p1nP1/p4PP1/1k6/5K2 w - - 0 1",
    "1b4bQ/2k4B/8/2p2NK1/2P1R3/1P4P1/p4B2/nr6 w - - 0 1",
    "K4k2/8/8/4QBP1/2p2pRq/4p2P/3rRP2/2B1n3 w - - 0 1",
    "1k1KRN2/8/4P3/2qpR1n1/pp6/1pp4P/1n5r/8 w - - 0 1",
    "8/7R/K4pk1/2p2p2/P1pP2P1/Pr3P2/1BP5/1N6 w - - 0 1",
    "4kb2/3r4/3Pb1P1/2nN3P/p6P/2R4p/3nK2p/8 w - - 0 1",
    "N7/3PP3/1Pk2P2/p2p4/5P1K/n4q2/1N1Qpp2/8 w - - 0 1",
    "B4k2/7P/7r/8/2p1p1PP/K4PPp/1p1N1B2/4q3 w - - 0 1",
    "1N1n4/6Pr/2P1p1p1/2bP1k2/8/5K2/1r2BppP/8 w - - 0 1",
    "6n1/p4b1P/qr2P3/2P3N1/R1P4p/3p4/3R4/3K2k1 w - - 0 1",
    "8/1N1Pp3/4P3/5N1K/5ppp/7P/pBp1k1B1/2b5 w - - 0 1",
    "8/1kp2K2/1Bp1P3/P2Q1p1p/8/p2p4/3n3P/q6B w - - 0 1",
    "8/3n2k1/1N3bN1/8/1R2P1p1/PB1rp1P1/KP2Q3/8 w - - 0 1",
    "2n5/P3PB2/P6b/5kBb/4p3/2K1p3/2p2pP1/2N5 w - - 0 1",
    "4R1K1/2kP1ppp/2Bn2P1/P4Q2/2N5/2pR4/1P6/8 w - - 0 1",
    "r3n3/1K2p1p1/2p5/4P3/p3P1RP/P2k4/5PPP/8 w - - 0 1",
    "N4B2/1K1P1n1k/PP2r2q/1b6/3P3P/5p2/6P1/5N2 w - - 0 1",
    "3B2R1/4Pp1p/k2bB1p1/5r2/PP6/4K2p/2P1P3/8 w - - 0 1",
    "8/P4B2/Q3p3/Pr1k4/qPp5/Pp4K1/2p5/4N2b w - - 0 1",
    "2N5/Pr5p/8/2P1K3/P1b2p2/k3P1Qp/2p2NP1/8 w - - 0 1",
    "n7/k5r1/bR6/4pp2/2Q5/3P4/1p1Pp2K/1Bb3R1 w - - 0 1",
    "7n/2P5/KP3PNk/p3p3/3Np3/2p1p3/p7/Q2b4 w - - 0 1",
    "2RK3N/1pp5/2p5/8/1k3r1P/6P1/1pP1qp2/3nb3 w - - 0 1",
    "8/2P5/1B1p1Pk1/1QP2rp1/3Pn1p1/1p3p2/5P2/K7 w - - 0 1",
];

fn main() {
    let depth = 8;
    let num_positions = CUTOFF_POSITIONS.len();

    println!("╔════════════════════════════════════════════════════════════════╗");
    println!("║              CUTOFF ANALYSIS - {} positions @ depth {}          ║", num_positions, depth);
    println!("╚════════════════════════════════════════════════════════════════╝");
    println!();

    let mut global_cutoffs = Cutoffs::new();
    let stop_flag = Arc::new(AtomicBool::new(false));

    for (i, fen) in CUTOFF_POSITIONS.iter().enumerate() {
        let mut position = Position::new(Some(fen));
        let mut evaluator = Evaluator::new();
        evaluator.set_silent(true);

        let mut search_options = SearchOptions::new();
        search_options.depth = Some(depth);
        let mut tt = TranspositionTable::new(32);

        evaluator.get_best_move(&mut position, search_options, &mut tt, &stop_flag, None);

        let cutoffs = &evaluator.result.cutoffs;
        global_cutoffs.total += cutoffs.total;
        global_cutoffs.move_1 += cutoffs.move_1;
        global_cutoffs.move_2 += cutoffs.move_2;
        global_cutoffs.avg_cutoff_move_no += cutoffs.avg_cutoff_move_no;

        // Progress indicator
        if (i + 1) % 50 == 0 || i + 1 == num_positions {
            println!("Progress: {}/{} positions analyzed", i + 1, num_positions);
        }
    }

    println!();
    println!("╔════════════════════════════════════════════════════════════════╗");
    println!("║                        RESULTS                                 ║");
    println!("╠════════════════════════════════════════════════════════════════╣");
    println!("║  Total cutoffs:              {:>10}                        ║", global_cutoffs.total);
    println!("║  Cutoffs on move 1:          {:>10} ({:>6.2}%)              ║",
        global_cutoffs.move_1,
        (global_cutoffs.move_1 as f32 / global_cutoffs.total as f32) * 100.0
    );
    println!("║  Cutoffs on move 2:          {:>10} ({:>6.2}%)              ║",
        global_cutoffs.move_2,
        (global_cutoffs.move_2 as f32 / global_cutoffs.total as f32) * 100.0
    );
    println!("║  Cutoffs on move 1 or 2:     {:>10} ({:>6.2}%)              ║",
        global_cutoffs.move_1 + global_cutoffs.move_2,
        ((global_cutoffs.move_1 + global_cutoffs.move_2) as f32 / global_cutoffs.total as f32) * 100.0
    );
    println!("║  Avg move # causing cutoff:  {:>10.2}                        ║",
        global_cutoffs.avg_cutoff_move_no / global_cutoffs.total as f32
    );
    println!("╚════════════════════════════════════════════════════════════════╝");
    println!();
    println!("Interpretation:");
    println!("  - Higher % on move 1 = better move ordering");
    println!("  - Lower avg move # = better pruning efficiency");
    println!("  - Goal: >90% cutoffs on move 1 or 2");
}
